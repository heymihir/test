import pandas as pd
import numpy as np

def transform(df):
    df = df.copy()
    for col in df.columns:
        if pd.api.types.is_numeric_dtype(df[col]):
            df[col] = df[col].round(3)
        elif pd.api.types.is_string_dtype(df[col]):
            df[col] = df[col].str.upper()
    return df

dm = transform(df_manual)
dc = transform(df_code)

dc_lookup = dc.set_index("CUST_ID.1")
for col in dm.columns:
    if col != "CUST_ID.1":
        dm[f"{col}_code"] = dm["CUST_ID.1"].map(dc_lookup[col])
        dm[f"is_equal_{col}"] = np.where(dm[col] == dm[f"{col}_code"], 1, 0)

cols = [col for col in dm.columns if col.startswith("is_equal_")]
result_df = pd.DataFrame({col: [100 * (dm[col] != 1).mean()] for col in cols}, index=["Not Equal %"])
print(result_df)
