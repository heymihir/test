import pandas as pd

# Load the Excel file
file_path = "/mnt/data/file-BPZcBsQNUHQPjoAdHX7eDE"
df = pd.read_excel(file_path)

# Identify positions for empty columns (every 6th column starting from C)
num_cols = df.shape[1]
new_columns = []
merge_headers = ['CUA', 'EEFC', 'TMD', 'ASSTES']
merge_positions = []

for i, col in enumerate(df.columns):
    new_columns.append(col)
    if (i + 1) % 6 == 0:  # Every 6th column (starting from C)
        empty_col_name = f'Empty_{i+1}'
        new_columns.append(empty_col_name)  # Insert empty column
        merge_positions.append(len(new_columns) - 6)  # Track merge start positions

# Create the modified DataFrame
df = df.reindex(columns=new_columns, fill_value='')

# Write to Excel with formatting
with pd.ExcelWriter("modified_file.xlsx", engine="xlsxwriter") as writer:
    df.to_excel(writer, index=False, sheet_name="Sheet1", startrow=2, header=False)
    
    workbook = writer.book
    worksheet = writer.sheets["Sheet1"]
    
    # Merge header cells and write merged labels
    for i, label in enumerate(merge_headers):
        if i < len(merge_positions):
            start_col = merge_positions[i]
            end_col = start_col + 5  # Merge over 6 columns
            worksheet.merge_range(0, start_col, 0, end_col, label, workbook.add_format({'bold': True, 'align': 'center'}))
    
    # Write actual headers below the merged row
    for col_num, column_name in enumerate(df.columns):
        worksheet.write(1, col_num, column_name, workbook.add_format({'bold': True}))
    
    print("Excel file 'modified_file.xlsx' has been created.")
